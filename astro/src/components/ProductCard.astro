---
import { Image } from 'astro:assets';
import type { StrapiProduct } from '../services/strapi';

interface Props {
  product: StrapiProduct;
}

const { product } = Astro.props;
const mainImage = product.attributes.images.data[0].attributes;
---

<article class="bg-background-100 rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow">
  <div class="relative aspect-square mb-4">
    <Image
      src={mainImage.url}
      alt={product.attributes.name}
      width={400}
      height={400}
      class="rounded-lg object-cover w-full h-full"
      loading="lazy"
    />
  </div>

  <h3 class="text-lg font-bold text-primary-900 mb-2">
    {product.attributes.name}
  </h3>
  
  <div class="flex items-center justify-between mb-4">
    <span class="text-accent-500 font-bold">
      {new Intl.NumberFormat('ru-RU').format(product.attributes.price)} ₽
    </span>
    <div class="flex gap-2">
      {product.attributes.colors.map(color => (
        <span 
          class="w-4 h-4 rounded-full border border-secondary-200"
          style={`background-color: ${color}`}
        ></span>
      ))}
    </div>
  </div>

  <button
    class="w-full bg-accent-500 text-background-50 py-2 rounded-lg hover:bg-accent-600 transition-colors"
  >
    В корзину
  </button>
</article>

<script define:vars={{product}}> 
  const button = document.querySelector('button')

  if(button) {
    button.onclick = (e) => {
      const event = new CustomEvent('add-to-cart', {
        detail: { productId: product.id }
      });
      document.dispatchEvent(event);
    }
  }
</script>