import{u as b}from"./useToastStore.lMaPLGlc.js";import{u as A}from"./useLocale.DpE9Tbd2.js";import{j as D,k as _,l as C,d as w,c as P,o as l,a as d,b as s,t as f,F as k,r as F,i as j,f as h,e as $,g as N,n as I,m as z,p as E,q as L,h as T}from"./runtime-core.esm-bundler.Yy3iEb7t.js";import{_ as x}from"./_plugin-vue_export-helper.DlAUqK2U.js";const B=a=>({_tag:"Left",error:a}),M=a=>({_tag:"Right",value:a}),O=a=>a._tag==="Left",V=async(a="ru",u={},e=1,t=9)=>{try{const n=new URLSearchParams({locale:a,"pagination[page]":String(e),"pagination[pageSize]":String(t),...Object.entries(u).reduce((i,[v,p])=>(i[`filters[${v}][Name][$contains]`]=String(p),i),{}),populate:"Images"}),r=await fetch(`http://localhost:1337/api/products?${n.toString()}`);if(!r.ok){const i={status:r.status,name:`HTTP-${r.status}`,message:await r.text()};return b().showToast({type:"error",message:"Ошибка вывода данных",timeout:1e3}),B(i)}const o=await r.json();return b().showToast({type:"success",message:"Успех",timeout:1e3}),console.log(o),M(o)}catch(n){const r=n instanceof Error?n.message:"Неизвестная ошибка!";return b().showToast({type:"error",message:r,timeout:1e3}),B({status:500,name:"Network Error",message:r})}},c=D({products:[],filters:{category:"",type:""},pagination:{page:1,pageSize:9,hasMore:!0}}),m=_(!1),y=_(null),S=()=>{const a=e=>{c.filters={...c.filters,...e},c.pagination.page=1,c.products=[]},u=async()=>{m.value=!0,y.value=null;const{locale:e}=A(),t=await V(e.value,c.filters,c.pagination.page,c.pagination.pageSize);if(O(t)){y.value=t.error.message,m.value=!1;return}c.products=t.value.data,c.pagination.hasMore=t.value.meta.pagination.page<t.value.meta.pagination.pageCount,m.value=!1};return{state:c,loading:C(m),error:C(y),updateFilters:a,loadProducts:u}},R=w({__name:"ProductCard",props:{product:{}},setup(a,{expose:u}){u();const e=a,t=o=>new Intl.NumberFormat("ru-RU").format(o),n=P(()=>{const o=e.product.Images;return"http://localhost:1337"+(o?.[0]?.formats?.medium?.url||o?.[0]?.url||"/placeholder.jpg")}),r={props:e,formatPrice:t,mainImage:n};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}}),U={class:"group relative w-full rounded-xl bg-background-100 p-4 shadow-lg transition-shadow hover:shadow-xl"},q={class:"mb-4 aspect-square overflow-hidden rounded-lg"},G=["src","alt"],H={class:"mb-3 flex items-start justify-between"},J={class:"line-clamp-2 text-lg font-semibold text-primary-900"},K={class:"whitespace-nowrap font-bold text-accent-500"},Q={key:0,class:"mb-3 flex gap-2"},W={key:1,class:"mb-4 line-clamp-3 text-sm text-text-600"};function X(a,u,e,t,n,r){return l(),d("article",U,[s("div",q,[s("img",{src:t.mainImage,alt:e.product.Name,class:"h-full w-full object-cover transition-transform duration-300 group-hover:scale-105",loading:"lazy"},null,8,G)]),s("div",H,[s("h3",J,f(e.product.Name),1),s("span",K,f(t.formatPrice(e.product.Price))+" ₽ ",1)]),e.product.Colors?.length?(l(),d("div",Q,[(l(!0),d(k,null,F(e.product.Colors,(o,i)=>(l(),d("span",{key:i,class:"h-5 w-5 rounded-full border-2 border-secondary-200 shadow-sm",style:j({backgroundColor:o})},null,4))),128))])):h("",!0),e.product.Description?(l(),d("p",W,f(e.product.Description.flatMap(o=>o.children).map(o=>o.text).join(" ")),1)):h("",!0),s("button",{class:"w-full rounded-lg bg-accent-500 py-2.5 text-background-50 transition-colors hover:bg-accent-600",onClick:u[0]||(u[0]=o=>a.$emit("add-to-cart",e.product))}," В корзину ")])}const Y=x(R,[["render",X]]),Z=w({__name:"ProductsFilter",setup(a,{expose:u}){u();const{updateFilters:e}=S(),n={updateFilters:e,handleFilterChange:r=>{const o=r.target;e({[o.name]:o.value})}};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}}),ee={class:"flex items-center justify-center rounded-2xl bg-background-50 p-6 shadow-xl"},te={"data-submit-form":"",class:"flex w-full max-w-6xl flex-col gap-4 sm:flex-row"};function oe(a,u,e,t,n,r){return l(),d("div",ee,[s("form",te,[s("select",{name:"category",onChange:t.handleFilterChange,class:"w-full rounded-lg border border-secondary-200 bg-background-50 p-3 text-primary-900"},u[0]||(u[0]=[s("option",{value:""},"Виды",-1),s("option",{value:"Классическая"},"Классическая",-1),s("option",{value:"Скандинавская"},"Скандинавская",-1),s("option",{value:"Минимализм"},"Минимализм",-1)]),32),s("select",{name:"type",onChange:t.handleFilterChange,class:"w-full rounded-lg border border-secondary-200 bg-background-50 p-3 text-primary-900"},u[1]||(u[1]=[$('<option value="">Типы</option><option value="Стульчики">Стульчики</option><option value="Кресла">Кресла</option><option value="Диваны">Диваны</option><option value="Спальные">Спальные</option><option value="Кровати">Кровати</option>',6)]),32),u[2]||(u[2]=s("button",{type:"submit",class:"hidden"},null,-1))])])}const ue=x(Z,[["render",oe]]),re=w({__name:"ProductGrid",setup(a,{expose:u}){u();const{state:e,loading:t,error:n,loadProducts:r}=S(),o=_(null),i=_(null);z(()=>{r()}),E(()=>{o.value=new IntersectionObserver(([g])=>{g.isIntersecting&&e.pagination.hasMore&&!t.value&&e.pagination.page++},{threshold:.1}),i.value&&o.value.observe(i.value)}),L(()=>{o.value?.disconnect()});const v=P(()=>{const g="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 py-4";return e.products.length===1?`${g} justify-items-center`:g}),p={state:e,loading:t,error:n,loadProducts:r,observer:o,sentinel:i,gridClasses:v,ProductCard:Y,ProductsFilter:ue};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}}),ae={class:"product-grid"},se={key:0,class:"error-message"},ne={key:1,class:"loading-indicator"},le={ref:"sentinel",class:"scroll-sentinel"};function ie(a,u,e,t,n,r){return l(),d("div",ae,[N(t.ProductsFilter,{"client:load":""}),t.error?(l(),d("div",se,f(t.error),1)):h("",!0),s("div",{class:I(t.gridClasses)},[(l(!0),d(k,null,F(t.state.products,o=>(l(),T(t.ProductCard,{"client:load":"",key:o.id,product:o},null,8,["product"]))),128))],2),t.loading?(l(),d("div",ne,"Загрузка...")):h("",!0),s("div",le,null,512)])}const me=x(re,[["render",ie]]);export{me as default};
