import{u as h}from"./useToastStore.DjKTEvMG.js";import{r as S,j as m,k as C,d as b,o as l,a as d,b as a,t as _,F as P,l as x,i as D,e as A,g as k,f as w,w as $,m as j,p as N,h as E}from"./runtime-core.esm-bundler.D23soL21.js";import{_ as y}from"./_plugin-vue_export-helper.DlAUqK2U.js";const B=s=>({_tag:"Left",error:s}),T=s=>({_tag:"Right",value:s}),L=s=>s._tag==="Left",M=async(s="ru",t={},e=1,o=9)=>{try{const n=new URLSearchParams({locale:s,"pagination[page]":String(e),"pagination[pageSize]":String(o),...Object.entries(t).reduce((c,[p,f])=>(c[`filters[${p}][Name][$contains]`]=String(f),c),{}),populate:"Images"}),u=await fetch(`http://localhost:1337/api/products?${n.toString()}`);if(!u.ok){const c={status:u.status,name:`HTTP-${u.status}`,message:await u.text()};return h().showToast({type:"error",message:"Ошибка вывода данных",timeout:1e3}),B(c)}const r=await u.json();return h().showToast({type:"success",message:"Успех",timeout:1e3}),console.log(r),T(r)}catch(n){const u=n instanceof Error?n.message:"Неизвестная ошибка!";return h().showToast({type:"error",message:u,timeout:1e3}),B({status:500,name:"Network Error",message:u})}},i=S({products:[],filters:{category:"",type:""},pagination:{page:1,pageSize:9,hasMore:!0},locale:"ru"}),g=m(!1),v=m(null),F=()=>{const s=e=>{i.filters={...i.filters,...e},i.pagination.page=1,i.products=[]},t=async()=>{g.value=!0,v.value=null;const e=await M(i.locale,i.filters,i.pagination.page,i.pagination.pageSize);if(L(e)){v.value=e.error.message,g.value=!1;return}i.products=e.value.data,i.pagination.hasMore=e.value.meta.pagination.page<e.value.meta.pagination.pageCount,g.value=!1};return{state:i,loading:C(g),error:C(v),updateFilters:s,loadProducts:t}},O=b({__name:"ProductCard",props:{product:{}},setup(s,{expose:t}){t();const n={formatPrice:u=>new Intl.NumberFormat("ru-RU").format(u),getDescription:u=>u.Description.flatMap(r=>r.children).map(r=>r.text).join(`
`)};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}}),z={class:"product-card"},I={class:"card-header"},V={class:"product-name"},R={class:"product-price"},U={class:"color-swatches"},G={class:"product-description"};function H(s,t,e,o,n,u){return l(),d("article",z,[a("div",I,[a("h3",V,_(e.product.Name),1),a("span",R,_(o.formatPrice(e.product.Price))+" ₽",1)]),a("div",U,[(l(!0),d(P,null,x(e.product.Colors,(r,c)=>(l(),d("span",{key:c,class:"color-swatch",style:D({backgroundColor:r})},null,4))),128))]),a("p",G,_(o.getDescription(e.product)),1),t[0]||(t[0]=a("button",{class:"add-to-cart-button"},"В корзину",-1))])}const q=y(O,[["render",H]]),J=b({__name:"ProductsFilter",setup(s,{expose:t}){t();const{updateFilters:e}=F(),n={updateFilters:e,handleFilterChange:u=>{const r=u.target;e({[r.name]:r.value})}};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}}),K={class:"flex items-center justify-center rounded-2xl bg-background-50 p-6 shadow-xl"},Q={"data-submit-form":"",class:"flex w-full max-w-6xl flex-col gap-4 sm:flex-row"};function W(s,t,e,o,n,u){return l(),d("div",K,[a("form",Q,[a("select",{name:"category",onChange:o.handleFilterChange,class:"w-full rounded-lg border border-secondary-200 bg-background-50 p-3 text-primary-900"},t[0]||(t[0]=[a("option",{value:""},"Виды",-1),a("option",{value:"Классическая"},"Классическая",-1),a("option",{value:"Скандинавская"},"Скандинавская",-1),a("option",{value:"Минимализм"},"Минимализм",-1)]),32),a("select",{name:"type",onChange:o.handleFilterChange,class:"w-full rounded-lg border border-secondary-200 bg-background-50 p-3 text-primary-900"},t[1]||(t[1]=[A('<option value="">Типы</option><option value="Стульчики">Стульчики</option><option value="Кресла">Кресла</option><option value="Диваны">Диваны</option><option value="Спальные">Спальные</option><option value="Кровати">Кровати</option>',6)]),32),t[2]||(t[2]=a("button",{type:"submit",class:"hidden"},null,-1))])])}const X=y(J,[["render",W]]),Y=b({__name:"ProductGrid",setup(s,{expose:t}){t();const{state:e,loading:o,error:n,loadProducts:u}=F(),r=m(null),c=m(null);$(()=>{u()}),j(()=>{r.value=new IntersectionObserver(([f])=>{f.isIntersecting&&e.pagination.hasMore&&!o.value&&e.pagination.page++},{threshold:.1}),c.value&&r.value.observe(c.value)}),N(()=>{r.value?.disconnect()});const p={state:e,loading:o,error:n,loadProducts:u,observer:r,sentinel:c,ProductCard:q,ProductsFilter:X};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}}),Z={class:"product-grid"},ee={key:0,class:"error-message"},te={class:"grid-layout"},ue={key:1,class:"loading-indicator"},oe={ref:"sentinel",class:"scroll-sentinel"};function re(s,t,e,o,n,u){return l(),d("div",Z,[k(o.ProductsFilter,{"client:load":""}),o.error?(l(),d("div",ee,_(o.error),1)):w("",!0),a("div",te,[(l(!0),d(P,null,x(o.state.products,r=>(l(),E(o.ProductCard,{"client:load":"",key:r.id,product:r},null,8,["product"]))),128))]),o.loading?(l(),d("div",ue,"Загрузка...")):w("",!0),a("div",oe,null,512)])}const ie=y(Y,[["render",re]]);export{ie as default};
