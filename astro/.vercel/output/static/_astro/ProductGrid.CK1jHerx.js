import{u as v}from"./useToastStore.DjKTEvMG.js";import{r as F,j as _,k as x,d as y,c as S,o as i,a as d,b as s,t as m,F as B,l as P,i as A,f,e as D,g as $,w as j,m as N,p as I,h as E}from"./runtime-core.esm-bundler.D23soL21.js";/* empty css                       */import{_ as w}from"./_plugin-vue_export-helper.DlAUqK2U.js";const C=a=>({_tag:"Left",error:a}),T=a=>({_tag:"Right",value:a}),z=a=>a._tag==="Left",L=async(a="ru",o={},e=1,u=9)=>{try{const n=new URLSearchParams({locale:a,"pagination[page]":String(e),"pagination[pageSize]":String(u),...Object.entries(o).reduce((c,[p,h])=>(c[`filters[${p}][Name][$contains]`]=String(h),c),{}),populate:"Images"}),r=await fetch(`http://localhost:1337/api/products?${n.toString()}`);if(!r.ok){const c={status:r.status,name:`HTTP-${r.status}`,message:await r.text()};return v().showToast({type:"error",message:"Ошибка вывода данных",timeout:1e3}),C(c)}const t=await r.json();return v().showToast({type:"success",message:"Успех",timeout:1e3}),console.log(t),T(t)}catch(n){const r=n instanceof Error?n.message:"Неизвестная ошибка!";return v().showToast({type:"error",message:r,timeout:1e3}),C({status:500,name:"Network Error",message:r})}},l=F({products:[],filters:{category:"",type:""},pagination:{page:1,pageSize:9,hasMore:!0},locale:"en"}),g=_(!1),b=_(null),k=()=>{const a=e=>{l.filters={...l.filters,...e},l.pagination.page=1,l.products=[]},o=async()=>{g.value=!0,b.value=null;const e=await L(l.locale,l.filters,l.pagination.page,l.pagination.pageSize);if(z(e)){b.value=e.error.message,g.value=!1;return}l.products=e.value.data,l.pagination.hasMore=e.value.meta.pagination.page<e.value.meta.pagination.pageCount,g.value=!1};return{state:l,loading:x(g),error:x(b),updateFilters:a,loadProducts:o}},M=y({__name:"ProductCard",props:{product:{}},setup(a,{expose:o}){o();const e=a,u=t=>new Intl.NumberFormat("ru-RU").format(t),n=S(()=>{const t=e.product.Images;return"http://localhost:1337"+(t?.[0]?.formats?.medium?.url||t?.[0]?.url||"/placeholder.jpg")}),r={props:e,formatPrice:u,mainImage:n};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}}),O={class:"group relative rounded-xl bg-background-100 p-4 shadow-lg transition-shadow hover:shadow-xl"},V={class:"mb-4 aspect-square overflow-hidden rounded-lg"},R=["src","alt"],U={class:"mb-3 flex items-start justify-between"},G={class:"line-clamp-2 text-lg font-semibold text-primary-900"},q={class:"whitespace-nowrap font-bold text-accent-500"},H={key:0,class:"mb-3 flex gap-2"},J={key:1,class:"mb-4 line-clamp-3 text-sm text-text-600"};function K(a,o,e,u,n,r){return i(),d("article",O,[s("div",V,[s("img",{src:u.mainImage,alt:e.product.Name,class:"h-full w-full object-cover transition-transform duration-300 group-hover:scale-105",loading:"lazy"},null,8,R)]),s("div",U,[s("h3",G,m(e.product.Name),1),s("span",q,m(u.formatPrice(e.product.Price))+" ₽ ",1)]),e.product.Colors?.length?(i(),d("div",H,[(i(!0),d(B,null,P(e.product.Colors,(t,c)=>(i(),d("span",{key:c,class:"h-5 w-5 rounded-full border-2 border-secondary-200 shadow-sm",style:A({backgroundColor:t})},null,4))),128))])):f("",!0),e.product.Description?(i(),d("p",J,m(e.product.Description.flatMap(t=>t.children).map(t=>t.text).join(" ")),1)):f("",!0),s("button",{class:"w-full rounded-lg bg-accent-500 py-2.5 text-background-50 transition-colors hover:bg-accent-600",onClick:o[0]||(o[0]=t=>a.$emit("add-to-cart",e.product))}," В корзину ")])}const Q=w(M,[["render",K]]),W=y({__name:"ProductsFilter",setup(a,{expose:o}){o();const{updateFilters:e}=k(),n={updateFilters:e,handleFilterChange:r=>{const t=r.target;e({[t.name]:t.value})}};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}}),X={class:"flex items-center justify-center rounded-2xl bg-background-50 p-6 shadow-xl"},Y={"data-submit-form":"",class:"flex w-full max-w-6xl flex-col gap-4 sm:flex-row"};function Z(a,o,e,u,n,r){return i(),d("div",X,[s("form",Y,[s("select",{name:"category",onChange:u.handleFilterChange,class:"w-full rounded-lg border border-secondary-200 bg-background-50 p-3 text-primary-900"},o[0]||(o[0]=[s("option",{value:""},"Виды",-1),s("option",{value:"Классическая"},"Классическая",-1),s("option",{value:"Скандинавская"},"Скандинавская",-1),s("option",{value:"Минимализм"},"Минимализм",-1)]),32),s("select",{name:"type",onChange:u.handleFilterChange,class:"w-full rounded-lg border border-secondary-200 bg-background-50 p-3 text-primary-900"},o[1]||(o[1]=[D('<option value="">Типы</option><option value="Стульчики">Стульчики</option><option value="Кресла">Кресла</option><option value="Диваны">Диваны</option><option value="Спальные">Спальные</option><option value="Кровати">Кровати</option>',6)]),32),o[2]||(o[2]=s("button",{type:"submit",class:"hidden"},null,-1))])])}const ee=w(W,[["render",Z]]),te=y({__name:"ProductGrid",setup(a,{expose:o}){o();const{state:e,loading:u,error:n,loadProducts:r}=k(),t=_(null),c=_(null);j(()=>{r()}),N(()=>{t.value=new IntersectionObserver(([h])=>{h.isIntersecting&&e.pagination.hasMore&&!u.value&&e.pagination.page++},{threshold:.1}),c.value&&t.value.observe(c.value)}),I(()=>{t.value?.disconnect()});const p={state:e,loading:u,error:n,loadProducts:r,observer:t,sentinel:c,ProductCard:Q,ProductsFilter:ee};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}}),oe={class:"product-grid"},ue={key:0,class:"error-message"},re={class:"lg:grid-cols-3 grid grid-cols-1 gap-6 sm:grid-cols-3"},ae={key:1,class:"loading-indicator"},se={ref:"sentinel",class:"scroll-sentinel"};function ne(a,o,e,u,n,r){return i(),d("div",oe,[$(u.ProductsFilter,{"client:load":""}),u.error?(i(),d("div",ue,m(u.error),1)):f("",!0),s("div",re,[(i(!0),d(B,null,P(u.state.products,t=>(i(),E(u.ProductCard,{"client:load":"",key:t.id,product:t},null,8,["product"]))),128))]),u.loading?(i(),d("div",ae,"Загрузка...")):f("",!0),s("div",se,null,512)])}const pe=w(te,[["render",ne]]);export{pe as default};
